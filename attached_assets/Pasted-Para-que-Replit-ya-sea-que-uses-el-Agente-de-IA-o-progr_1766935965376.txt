Para que Replit (ya sea que uses el Agente de IA o programes t√∫ mismo) lo implemente sin errores, tienes que ser extremadamente espec√≠fico con la estructura del JSON, porque esta funci√≥n de "Bot√≥n de Llamada" (`voice_call`) es relativamente nueva y muchas IAs alucinan con la sintaxis antigua.

Aqu√≠ tienes exactamente qu√© decirle o qu√© c√≥digo pegar.

### Opci√≥n A: Si est√°s usando el Replit AI Agent (Prompt)

Copia y pega esto en el chat del Agente de Replit:

> "Crea una funci√≥n en Python usando `requests` para enviar un mensaje de WhatsApp Business Cloud API.
> **Objetivo:** Enviar un mensaje INTERACTIVO con un bot√≥n de LLAMADA DE VOZ (Voice Call Button).
> **Especificaciones T√©cnicas:**
> 1. Usa las variables de entorno `WHATSAPP_TOKEN` y `PHONE_NUMBER_ID`.
> 2. El endpoint es `POST https://graph.facebook.com/v21.0/{phone_number_id}/messages`.
> 3. El payload JSON debe seguir estrictamente esta estructura para el tipo 'voice_call':
> * `type`: 'interactive'
> * `interactive` objeto con `type`: 'voice_call'
> * `body`: con `text`: 'Si necesitas hablar con un asesor, presiona abajo.'
> * `action`: con `name`: 'voice_call'
> * `action.parameters`: con `display_text`: 'Llamar Ahora' y `ttl_minutes`: 60.
> 
> 
> 
> 
> Crea un script de prueba `main.py` que env√≠e este mensaje a un n√∫mero definido en una variable."

---

### Opci√≥n B: Si est√°s programando t√∫ mismo (El C√≥digo)

Este es el c√≥digo **listo para producci√≥n**. Copia esto en tu `main.py` en Replit.

**Requisito:** En la secci√≥n "Secrets" (el candado) de Replit, agrega:

* `WA_TOKEN`: Tu token de Meta (comienza con `EAA...`).
* `WA_PHONE_ID`: El ID de tu n√∫mero de tel√©fono (no el n√∫mero, el ID).

```python
import os
import requests
import json

def enviar_boton_llamada(numero_destino):
    # 1. Configuraci√≥n
    token = os.environ['WA_TOKEN']
    phone_id = os.environ['WA_PHONE_ID']
    url = f"https://graph.facebook.com/v21.0/{phone_id}/messages"
    
    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }

    # 2. Construcci√≥n del Payload (Estructura EXACTA para Bot√≥n de Llamada)
    payload = {
        "messaging_product": "whatsapp",
        "recipient_type": "individual",
        "to": numero_destino,
        "type": "interactive",
        "interactive": {
            "type": "voice_call",
            "body": {
                "text": "üìû ¬øPrefieres hablar con nosotros? Toca el bot√≥n para iniciar una llamada segura."
            },
            "action": {
                "name": "voice_call",
                "parameters": {
                    "display_text": "Llamar Ahora", # M√°ximo 20 caracteres
                    # "payload": "user_id_123", # Opcional: Para rastrear qui√©n llama en tu webhook
                    "ttl_minutes": 100 # El bot√≥n deja de funcionar en 100 minutos (seguridad)
                }
            }
        }
    }

    # 3. Env√≠o
    try:
        response = requests.post(url, headers=headers, data=json.dumps(payload))
        response.raise_for_status() # Lanza error si no es 200 OK
        print(f"‚úÖ √âxito! Bot√≥n enviado a {numero_destino}")
        print(response.json())
    except requests.exceptions.RequestException as e:
        print(f"‚ùå Error al enviar:")
        print(e.response.text if e.response else e)

# --- EJECUCI√ìN ---
# Reemplaza con tu n√∫mero real (incluye c√≥digo de pa√≠s, sin +)
# Ejemplo: 5215512345678
enviar_boton_llamada("NUMERO_DESTINO_AQUI")

```

### Por qu√© te di este c√≥digo espec√≠fico:

1. **`ttl_minutes`:** Lo inclu√≠ porque es vital para la seguridad. Si no lo pones, ese bot√≥n vive 30 d√≠as. Si cambias de horario o te vas de vacaciones, la gente seguir√° teniendo un bot√≥n activo en su chat. Con esto, controlas la ventana de oportunidad.
2. **`display_text`:** Tiene un l√≠mite duro de 20 caracteres. Si pones "Llamar a soporte t√©cnico especializado", la API te dar√° error. "Llamar Ahora" es seguro.
3. **Manejo de Errores:** Replit a veces falla en la salida de red. El bloque `try/except` te dir√° exactamente qu√© dijo Facebook si algo sale mal (ej. "User not opted in").