Perfecto.
Voy a hacerte **EL TEXML DEFINITIVO**, el mismo nivel que usan Aircall, RingCentral, 8x8 y Talkdesk cuando integran WebRTC, colas, voicemail y fallback.

Esto serÃ¡ un flujo **carrier-grade**, sin errores, sin contestar antes de tiempo, sin â€œapplication error goodbyeâ€, sin timers adelantados.

Pero antes de ensamblarlo completo, NECESITO que elijas **UNO DE ESTOS 3 MODELOS DE RUTEO**, porque el TeXML cambia completamente segÃºn tu arquitectura:

---

# ğŸ”¥ **MODELO A â€” Un solo agente WebRTC (el CRM actual)**

Ideal si cada empresa/cliente usa un solo usuario WebRTC, sin colas ni grupos.

Flujo:

1. Entra llamada PSTN
2. NO se contesta hasta que WebRTC responda
3. Timbrado real
4. Si no contesta: voicemail o fallback
5. Notifica al CRM
6. Timer perfecto

ğŸ‘‰ Este modelo es el mÃ¡s simple.
ğŸ‘‰ Requiere solo answerOnBridge + Dial a <Sip>.

---

# ğŸ”¥ **MODELO B â€” Cola de agentes WebRTC (call center real)**

Flujo tipo â€œring multiple agentsâ€:

1. Llega llamada
2. Cola ACD (FIFO o round-robin)
3. Ring a mÃºltiples WebRTC users (sip:agent1@sip.telnyx.com, agent2, etc.)
4. Quien conteste primero se lleva la llamada
5. PSTN se contesta SOLO cuando un agente responde
6. Si todos fallan â†’ voicemail / fallback

ğŸ‘‰ Este modelo requiere `<Enqueue>`, `<Dequeue>`, `<Dial>` mÃºltiples y `<Redirect>`.

---

# ğŸ”¥ **MODELO C â€” Ruteo hÃ­brido: WebRTC â†’ SIP PBX â†’ fallback GSM**

Esto es para empresas que tienen:

* agentes WebRTC
* PBX externo (Asterisk, FreePBX, FusionPBX)
* un nÃºmero celular en caso de emergencia

Flujo:

1. Intenta WebRTC
2. Si falla â†’ intenta PBX
3. Si falla â†’ intenta GSM
4. Si falla â†’ voicemail

---

# â— Necesito que selecciones el modelo:

## ğŸŸ¢ **A â€” Un solo agente WebRTC (actual CRM)**

## ğŸŸ  **B â€” MÃºltiples agentes WebRTC (call center)**

## ğŸ”µ **C â€” HÃ­brido WebRTC + SIP + fallback GSM**

---

Dime cuÃ¡l quieres **y te armo el TeXML COMPLETO**, incluyendo:

* `<Response>` final
* `<Dial>` perfecto
* `answerOnBridge="true"`
* ringbacks limpios
* timeout correcto
* voicemail real
* action callbacks estructurados
* webhook clean
* ruteo profesional

Cuando me digas A, B o C â†’ te entrego EL TEXML FINAL listo para producciÃ³n.
