Act as a Senior Backend Architect. We are wiping the slate clean to build a high-performance WhatsApp Service for a CRM.
PREVIOUS ATTEMPTS FAILED due to "ghost chats" (empty contacts appearing as chats) and unstable versions.

### 1. STRICT ENVIRONMENT SETUP
- **Environment:** Replit (Node.js + TypeScript).
- **Database:** PostgreSQL (Use `pg` client).
- **Library Version:** YOU MUST INSTALL `npm install @whiskeysockets/baileys@6.7.21`. DO NOT install v7.0.0-RC (it is unstable).
- **Other Deps:** `pg`, `pino`, `qrcode-terminal`, `express`, `cors`.

### 2. DATABASE SCHEMA (PostgreSQL)
Create a SQL initialization script that guarantees data integrity.
- **Table `auth_sessions`:** Columns `id` (VARCHAR PK), `cred_data` (JSONB). -> *Crucial for persistence without files.*
- **Table `contacts`:** `jid` (PK), `name`, `img_url`.
- **Table `messages`:** `id` (PK), `jid` (chat_id), `from_me` (BOOLEAN), `content` (TEXT/JSON), `msg_type` (text/image/audio), `timestamp` (BIGINT).
- **Table `chats`:** `jid` (PK), `unread_count` (INT), `last_message_ts` (BIGINT).

### 3. BACKEND LOGIC (The "No-Fail" Rules)

#### A. Custom Auth Strategy (NO FILE SYSTEM)
You must implement a custom `AuthState` that reads/writes to the `auth_sessions` table.
- Do NOT use `useMultiFileAuthState`.
- Provide a helper function `usePostgresAuthState(dbClient)` that mimics the behavior of Baileys auth but directs I/O to Postgres.

#### B. Event Handling (Strict Data Flow)
- **On `connection.update`:** Handle reconnections automatically.
- **On `messages.upsert`:**
  1. Extract message data.
  2. INSERT into `messages` table.
  3. UPSERT into `chats` table SETting `last_message_ts` = current_time. *This ensures only active chats exist.*
- **On `contacts.upsert`:**
  1. INSERT/UPDATE `contacts` table only. DO NOT create a row in `chats`. *This prevents "ghost chats".*

#### C. The API Endpoints (The Fix for the UI)
- **`GET /chats`:**
  - **CRITICAL REQUIREMENT:** This query MUST filter out empty conversations.
  - SQL Logic: `SELECT * FROM chats WHERE last_message_ts IS NOT NULL ORDER BY last_message_ts DESC`.
  - Join with `contacts` to get the name/image.
  - Do NOT return a chat if it has 0 messages.

- **`GET /messages/:jid`:** Return messages ordered by timestamp ASC.

### 4. IMPLEMENTATION ORDER
1. Generate the `schema.sql`.
2. Generate the `postgres-auth.ts` (The custom adapter).
3. Generate the `whatsapp-service.ts` (The core logic).
4. Generate the `server.ts` (Express API).

**Constraints:**
- Use strict TypeScript types.
- Do NOT use `makeInMemoryStore` (It causes memory leaks).
- Add comments explaining *why* we filter chats (to avoid the empty contact issue).

Proceed to generate the files.