Aqu√≠ tienes la especificaci√≥n t√©cnica **exacta y a prueba de errores** para que se la pases a tu agente de Replit.

Para que funcione como WhatsApp Web, la clave no es solo enviar el emoji, es **identificar correctamente el mensaje al que reaccionas**. Si el agente se equivoca en el `id` o en el `fromMe`, la reacci√≥n fallar√° silenciosamente.

Copia y pega las siguientes instrucciones en tu chat con el agente de Replit:

-----

### **Instrucciones para el Agente (Implementation Spec: WhatsApp Reactions)**

**Objetivo:** Implementar la funci√≥n de reaccionar a mensajes (Like, Coraz√≥n, Risa, etc.) usando Evolution API v2.
**Requisito UX:** Debe sentirse instant√°neo, igual que en WhatsApp Web.

#### 1\. La L√≥gica T√©cnica (The "Key" Object)

Para reaccionar, no basta con el n√∫mero de tel√©fono. Necesitamos reconstruir la `key` (llave √∫nica) del mensaje objetivo.

  * **`remoteJid`**: El n√∫mero del chat (ej: `521555...@s.whatsapp.net`).
  * **`id`**: El ID √∫nico del mensaje al que vamos a reaccionar (ej: `BAE5F...`).
  * **`fromMe`**: **CR√çTICO.**
      * Es `false` si reaccionamos a un mensaje que envi√≥ el **cliente**.
      * Es `true` si reaccionamos a un mensaje que enviamos **nosotros** (el bot/agente).

#### 2\. El Endpoint de la API

  * **M√©todo:** `POST`
  * **Endpoint:** `/message/sendReaction/{instance_name}`
  * **Payload JSON:**

<!-- end list -->

```json
{
  "reaction": "‚ù§Ô∏è",  // El emoji literal (o string vac√≠o "" para quitar la reacci√≥n)
  "key": {
    "remoteJid": "5215555555555@s.whatsapp.net",
    "fromMe": false, // Cambiar din√°micamente seg√∫n qui√©n envi√≥ el mensaje original
    "id": "ID_DEL_MENSAJE_ORIGINAL"
  }
}
```

#### 3\. C√≥digo de Implementaci√≥n (TypeScript / Node.js)

Implementa esta funci√≥n en `evolution-api.ts` para manejar la l√≥gica autom√°ticamente:

```typescript
/**
 * Env√≠a una reacci√≥n a un mensaje espec√≠fico.
 * @param instance Nombre de la instancia
 * @param remoteJid JID del chat (n√∫mero@s.whatsapp.net)
 * @param messageId ID √∫nico del mensaje a reaccionar
 * @param reactionEmoji El emoji (ej: "üëç", "‚ù§Ô∏è", "üòÇ"). Pasar cadena vac√≠a "" para quitar reacci√≥n.
 * @param messageFromMe true si el mensaje objetivo es nuestro, false si es del cliente.
 */
export async function sendReaction(
  instance: string, 
  remoteJid: string, 
  messageId: string, 
  reactionEmoji: string, 
  messageFromMe: boolean
) {
  try {
    const response = await axios.post(
      `${process.env.EVOLUTION_URL}/message/sendReaction/${instance}`,
      {
        reaction: reactionEmoji,
        key: {
          remoteJid: remoteJid,
          fromMe: messageFromMe,
          id: messageId
        }
      },
      {
        headers: { apikey: process.env.EVOLUTION_API_KEY }
      }
    );
    return response.data;
  } catch (error) {
    console.error("Error enviando reacci√≥n:", error);
    throw error;
  }
}
```

#### 4\. Instrucciones para el Frontend (UI/UX)

Para que se sienta como WhatsApp Web ("Optimistic UI"):

1.  **Feedback Instant√°neo:** Cuando el usuario haga clic en el emoji, **agr√©galo visualmente al chat inmediatamente**, NO esperes a que la API responda.
      * *Si la API falla despu√©s:* Muestra un error y quita el emoji (rollback).
2.  **Toggle (Quitar reacci√≥n):**
      * Si el usuario hace clic en el **mismo** emoji que ya puso, la funci√≥n debe enviar una cadena vac√≠a `""` como `reactionEmoji` para eliminarla.
3.  **Men√∫ de Emojis:**
      * Implementa los 6 cl√°sicos: üëç ‚ù§Ô∏è üòÇ üòÆ üò¢ üôè

-----

### **Nota Estrat√©gica para ti (Humano):**

El error m√°s com√∫n aqu√≠ es que tu base de datos no tenga guardado si el mensaje fue `fromMe` o no.

  * Si tu tabla de mensajes no tiene una columna `is_from_me` (booleano), **el agente no podr√° saber qu√© poner en el payload**.
  * **Verifica ahora:** Aseg√∫rate de que al guardar los mensajes entrantes y salientes, est√°s guardando ese dato. Si no, las reacciones fallar√°n en el 50% de los casos (cuando intentes reaccionar a tus propios mensajes).